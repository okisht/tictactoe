<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>


    <style>
        .tttContainer {
            width: 156px;
        }

        .ttt {
            display: flex;
            flex-wrap: wrap;
        }

        .ttt-box {
            height: 50px;
            width: 50px;
            border: 1px solid black;
        }

        .drawed {
            pointer-events:none !important;
        }

    </style>


</head>

<body>

    <div class="tttContainer">
        <div class="ttt">
            <div class="ttt-box" data-value="0"></div>
            <div class="ttt-box" data-value="0"></div>
            <div class="ttt-box" data-value="0"></div>
            <div class="ttt-box" data-value="0"></div>
            <div class="ttt-box" data-value="0"></div>
            <div class="ttt-box" data-value="0"></div>
            <div class="ttt-box" data-value="0"></div>
            <div class="ttt-box" data-value="0"></div>
            <div class="ttt-box" data-value="0"></div>
        </div>

        <select>
            <option value="vsComputer">Play vs computer!</option>
            <option value="vsPlayer">Play vs Player!</option>
        </select>
    </div>

    <script src="http://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous">
        </script>

    <script>
        var moveCounter = 0;
        var userPlays = 1;

        $('.ttt-box').click(function () {

            var ind = $('.ttt-box').index(this) + 1;
            var getVal = parseInt($(this).attr("data-value"));

            if (getVal === 0 && moveCounter % 2 === 0) {
                draw($(this).index(),1,"X");
              /*  $(this).attr("data-value", 1);
                $(this).text("X");*/
            }

            else if (getVal === 0 && moveCounter % 2 === 1) {
                draw($(this).index(),2,"O"); 
                /*$(this).attr("data-value", 2);
                $(this).text("O");*/
            }

            winStatement();
            moveCounter = moveCounter + 1;

            const vsToWho = $('select').val();
            if (vsToWho === 'vsComputer') {
                nextMove(userPlays);
            }

        })

        function winStatement() {

            var dataValues = collectValues();

            for (j = 0; j < 3; j++) {
                if ((dataValues[j] === dataValues[j + 3]) && (dataValues[j + 3] === dataValues[j + 6])) {

                    if (dataValues[j] === 2) {
                        console.log("O kazandı");
                    }
                    else if (dataValues[j] === 1) {
                        console.log("X kazandı");
                    }
                }

            }

            for (k = 0; k < 9; k++) {
                if ((dataValues[k] === dataValues[k + 1]) && (dataValues[k + 1] === dataValues[k + 2])) {

                    if (dataValues[k] === 2) {
                        console.log("O kazandı");
                    }
                    else if (dataValues[k] === 1) {
                        console.log("X kazandı");
                    }
                }
                k = k + 2;
            }


            if (((dataValues[0] === dataValues[4]) && (dataValues[4] === dataValues[8])) || ((dataValues[2] === dataValues[4]) && (dataValues[4] === dataValues[6]))) {

                if (dataValues[4] === 2) {
                    console.log("O kazandı");
                }
                else if (dataValues[4] === 1) {
                    console.log("X kazandı");
                }

            }


        }

        function collectValues() {
            var dataVls = [];
            var k = $('.ttt-box').length;
            for (i = 0; i < k; i++) {
                dataVls.push(parseInt($('.ttt-box').eq(i).attr('data-value')));
            }

            return dataVls;
        }

        function nextMove(userPlaying) {

            var defineUser = "";
            var defineVal = 0;

            if (userPlaying == 1) {
                defineUser = "O";
                defineVal = 2;
            }

            else {
                defineUser = "X";
                defineVal = 1;
            }

            const valueMatris = collectValues();

            if (moveCounter == 1) {
                if (valueMatris[4] === 0) {
                    draw(4,defineVal,defineUser); 
                    /*$('.ttt-box').eq(4).attr("data-value", defineVal);
                    $('.ttt-box').eq(4).text(defineUser);*/
                    moveCounter = moveCounter + 1;
                    winStatement();
                }

                else if (valueMatris[4] === 1) {
                    var randmMoves = [0, 2, 6, 8];
                    var randmMove = randmMoves[Math.floor(Math.random() * randmMoves.length)];
                    draw(randmMove,defineVal,defineUser); 
                   /* $('.ttt-box').eq(randmMove).attr("data-value", defineVal);
                    $('.ttt-box').eq(randmMove).text(defineUser);*/
                    moveCounter = moveCounter + 1;
                    winStatement();
                }

            }

            else if (moveCounter % 2 == 1) {

                const winMove = checkIfOpntnWin(valueMatris, 2);
                if (winMove === undefined || winMove === null) {
                    const decidedMove = checkIfOpntnWin(valueMatris, userPlaying);
                    draw(decidedMove,defineVal,defineUser); 
                    /*$('.ttt-box').eq(decidedMove).attr("data-value", defineVal);
                    $('.ttt-box').eq(decidedMove).text(defineUser);*/

                    if (decidedMove === undefined || decidedMove === null) {

                        var anyMoveCont = [];
                        for (j=0;j < valueMatris.length; j++) {
                            if (valueMatris[j] === 0) {
                                anyMoveCont.push(j);
                            }
                        }
                        var anyMove = anyMoveCont[Math.floor(Math.random() * anyMoveCont.length)];
                        draw(anyMove,defineVal,defineUser); 
                        /*$('.ttt-box').eq(anyMove).attr("data-value", defineVal);
                        $('.ttt-box').eq(anyMove).text(defineUser);*/
                    }
                }

                else {
                    draw(winMove,defineVal,defineUser); 
                    /*$('.ttt-box').eq(winMove).attr("data-value", defineVal);
                    $('.ttt-box').eq(winMove).text(defineUser);*/
                }

                moveCounter = moveCounter + 1;
                winStatement();

            }
        }


        function checkIfOpntnWin(valuesMatriss, checkVal) {

            for (i = 0; i < valuesMatriss.length; i++) {
                if (i == 0) {
                    if (valuesMatriss[i] === checkVal) {

                        if (valuesMatriss[i + 1] === checkVal && valuesMatriss[2] === 0) {
                            return 2;
                            break;
                        }

                        if (valuesMatriss[i + 3] === checkVal && valuesMatriss[6] === 0) {
                            return 6;
                            break;
                        }

                        if (valuesMatriss[i + 4] === checkVal && valuesMatriss[8] === 0) {
                            return 8;
                            break;
                        }

                        if (valuesMatriss[i + 2] === checkVal && valuesMatriss[1] === 0) {
                            return 1;
                            break;
                        }

                        if (valuesMatriss[i + 6] === checkVal && valuesMatriss[3] === 0) {
                            return 3;
                            break;
                        }

                        if (valuesMatriss[i + 8] === checkVal && valuesMatriss[4] === 0) {
                            return 4;
                            break;
                        }

                        /*
                        check 
                        0-1
                        0-3
                        0-4
                        0-2  
                        0-6  
                        0-8
                        */
                    }

                }

                else if (i == 2) {
                    if (valuesMatriss[i] == checkVal) {

                        if (valuesMatriss[i - 1] === checkVal && valuesMatriss[0] === 0) {
                            return 0;
                            break;
                        }

                        if (valuesMatriss[i + 2] === checkVal && valuesMatriss[6] === 0) {
                            return 6;
                            break;
                        }

                        if (valuesMatriss[i + 3] === checkVal && valuesMatriss[8] === 0) {
                            return 8;
                            break;
                        }

                        if (valuesMatriss[i + 6] === checkVal && valuesMatriss[5] === 0) {
                            return 5;
                            break;
                        }

                        if (valuesMatriss[i + 4] === checkVal && valuesMatriss[4] === 0) {
                            return 4;
                            break;
                        }

                        /*
                        check 
                        2-1
                        2-4
                        2-5
                        2-8
                        2-6
                        */
                    }

                }

                else if (i == 4) {
                    if (valuesMatriss[i] == checkVal) {

                        if (valuesMatriss[i - 3] === checkVal && valuesMatriss[7] === 0) {
                            return 7;
                            break;
                        }

                        if (valuesMatriss[i - 1] === checkVal && valuesMatriss[5] === 0) {
                            return 5;
                            break;
                        }

                        if (valuesMatriss[i + 1] === checkVal && valuesMatriss[3] === 0) {
                            return 3;
                            break;
                        }

                        if (valuesMatriss[i + 3] === checkVal && valuesMatriss[1] === 0) {
                            return 1;
                            break;
                        }
                        /*
                        check 
                        4-1
                        4-3
                        4-5
                        4-7
                        */
                    }

                }

                else if (i == 6) {
                    if (valuesMatriss[i] == checkVal) {


                        if (valuesMatriss[i - 3] === checkVal && valuesMatriss[0] === 0) {
                            return 0;
                            break;
                        }

                        if (valuesMatriss[i - 2] === checkVal && valuesMatriss[2] === 0) {
                            return 2;
                            break;
                        }

                        if (valuesMatriss[i + 1] === checkVal && valuesMatriss[8] === 0) {
                            return 8;
                            break;
                        }

                        if (valuesMatriss[i + 2] === checkVal && valuesMatriss[5] === 0) {
                            return 5;
                            break;
                        }

                        if (valuesMatriss[i - 4] === checkVal && valuesMatriss[4] === 0) {
                            return 4;
                            break;
                        }

                        /*
                        check 
                        6-3
                        6-4
                        6-7
                        6-8
                        6-2
                        */
                    }

                }

                else if (i == 8) {
                    if (valuesMatriss[i] == checkVal) {

                        if (valuesMatriss[i - 4] === checkVal && valuesMatriss[0] === 0) {
                            return 0;
                            break;
                        }

                        if (valuesMatriss[i - 3] === checkVal && valuesMatriss[2] === 0) {
                            return 2;
                            break;
                        }

                        if (valuesMatriss[i - 1] === checkVal && valuesMatriss[6] === 0) {
                            return 6;
                            break;
                        }

                        /*
                        check 
                        8-4
                        8-5
                        8-7
                        */
                    }

                }

/* çapraz ortası boş durumların kontrolü */
                else if ( i == 1) {
                    if (valuesMatriss[i] == checkVal) {
                        
                        if (valuesMatriss[i + 6] === checkVal && valuesMatriss[4] === 0) {
                            return 4;
                            break;
                        }

                    }

                    if (valuesMatriss[i + 2] == checkVal) {
                        
                        if (valuesMatriss[i + 4] === checkVal && valuesMatriss[4] === 0) {
                            return 4;
                            break;
                        }

                    }

                }
            }

        }

        function draw(getMove,getDefinedVal,getDefinedUser) {
            $('.ttt-box').eq(getMove).attr("data-value", getDefinedVal);
            $('.ttt-box').eq(getMove).text(getDefinedUser);
            $('.ttt-box').eq(getMove).addClass("drawed");
        }

    </script>

</body>

</html>